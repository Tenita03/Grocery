<!‚Äî Grocery App Code ‚Äî>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Grocery List</title>

<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f5f5f7;
    color: #111;
  }

  .app {
    max-width: 480px;
    margin: 0 auto;
    padding: 16px;
  }

  h1 {
    text-align: center;
    font-size: 1.5rem;
    margin-bottom: 16px;
  }

  .add-form {
    display: grid;
    gap: 8px;
    margin-bottom: 16px;
  }

  input, select, button {
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  button {
    background: #007aff;
    color: white;
    border: none;
    cursor: pointer;
  }

  button:active {
    transform: scale(0.98);
  }

  .list {
    display: grid;
    gap: 10px;
  }

  .item {
    background: white;
    border-radius: 14px;
    padding: 12px;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    align-items: center;
  }

  .item.need {
    border-left: 5px solid #ff3b30;
  }

  .item.have {
    border-left: 5px solid #34c759;
    opacity: 0.85;
  }

  .details {
    display: grid;
    gap: 4px;
  }

  .name {
    font-weight: 600;
  }

  .meta {
    font-size: 0.85rem;
    color: #666;
  }

  .controls {
    display: grid;
    gap: 6px;
  }

  .small-btn {
    padding: 6px 10px;
    font-size: 0.85rem;
    border-radius: 8px;
  }
</style>
</head>
<body>

<div class="app">
  <h1>Grocery List</h1>

  <div class="add-form">
    <input id="name" placeholder="Item name" />
    <input id="quantity" type="number" min="1" placeholder="Quantity" />
    <input id="store" placeholder="Store (optional)" />
    <button onclick="addItem()">Add Item</button>
  </div>

<div class="filters">
  <button onclick="setMode('all')">All</button>
  <button onclick="setMode('shopping')">üõí Shopping</button>
  <button onclick="setMode('inventory')">üì¶ Inventory</button>

  <button onclick="markAllBought()">‚úî Buy All</button>
  <button onclick="clearHaveItems()">üßπ Clear Have</button>

  <button onclick="startSession()">‚ñ∂Ô∏è Start Session</button>
  <button onclick="endSession(true)">‚úî Finish</button>
  <button onclick="endSession(false)">‚úñ Cancel</button>

  <select id="storeFilter" onchange="filterStore = this.value; saveUIState(); render()">
    <option value="all">All Stores</option>
  </select>
</div>

  <div class="list" id="list"></div>
</div>

<details style="margin-top:16px;">
  <summary style="cursor:pointer;font-weight:600;">üìú Purchase History</summary>
  <div id="history"></div>
</details>

<script>
/* =========================
   STORAGE KEYS
========================= */
const STORAGE_KEY = "grocery-items";
const UI_STATE_KEY = "grocery-ui-state";
const SESSION_KEY = "grocery-shopping-session";

const HISTORY_KEY = "grocery-purchase-history";
let history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];

function saveHistory() {
  localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
}

/* =========================
   STATE
========================= */
let items = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

let filterStatus = "all";
let filterStore = "all";
let mode = "all";

let shoppingSession = JSON.parse(localStorage.getItem(SESSION_KEY)) || null;

/* =========================
   LOAD UI STATE (ONCE)
========================= */
const savedUI = JSON.parse(localStorage.getItem(UI_STATE_KEY));
if (savedUI) {
  mode = savedUI.mode || "all";
  filterStatus = savedUI.filterStatus || "all";
  filterStore = savedUI.filterStore || "all";
}

/* =========================
   SAVE HELPERS
========================= */
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
}

function saveUIState() {
  localStorage.setItem(
    UI_STATE_KEY,
    JSON.stringify({ mode, filterStatus, filterStore })
  );
}

function saveSession() {
  localStorage.setItem(SESSION_KEY, JSON.stringify(shoppingSession));
}

/* =========================
   SESSION LOGIC
========================= */
function startSession() {
  const store = prompt("Shopping where?", filterStore !== "all" ? filterStore : "");
  shoppingSession = { store: store || "", items: [] };
  saveSession();
  render();
}

if (commit && shoppingSession) {
  const purchasedItems = [];

  shoppingSession.items.forEach(id => {
    const item = items.find(i => i.id === id);
    if (!item) return;

    item.status = "have";
    item.quantity = Math.max(item.lastQty || item.quantity || 1, 1);
    item.lastQty = item.quantity;

    purchasedItems.push({
      name: item.name,
      qty: item.quantity
    });
  });

  history.unshift({
    id: crypto.randomUUID(),
    date: new Date().toISOString(),
    store: shoppingSession.store || "Unknown",
    items: purchasedItems
  });

  save();
  saveHistory();
}

      item.status = "have";
      item.quantity = Math.max(item.lastQty || item.quantity || 1, 1);
      item.lastQty = item.quantity;
    });
    save();
  }

  shoppingSession = null;
  localStorage.removeItem(SESSION_KEY);
  render();
}

function toggleSessionItem(id) {
  if (!shoppingSession) return;

  const idx = shoppingSession.items.indexOf(id);
  if (idx === -1) shoppingSession.items.push(id);
  else shoppingSession.items.splice(idx, 1);

  saveSession();
  render();
}

/* =========================
   FILTERS / MODES
========================= */
function setMode(newMode) {
  mode = newMode;

  if (mode === "shopping") filterStatus = "need";
  else if (mode === "inventory") filterStatus = "have";
  else filterStatus = "all";

  saveUIState();
  render();
}

/* =========================
   STORE FILTER
========================= */
function updateStoreFilter() {
  const select = document.getElementById("storeFilter");
  if (!select) return;

  const current = filterStore;
  const stores = [...new Set(items.map(i => (i.store || "").trim()).filter(Boolean))].sort();

  select.innerHTML =
    `<option value="all">All Stores</option>` +
    stores.map(s => `<option value="${s}">${s}</option>`).join("");

  select.value = current;
}

/* =========================
   CRUD ACTIONS
========================= */
function addItem() {
  const name = document.getElementById("name").value.trim();
  const quantity = Number(document.getElementById("quantity").value) || 1;
  const store = document.getElementById("store").value.trim();

  if (!name) return;

  const existing = items.find(i => i.name.toLowerCase() === name.toLowerCase());

  if (existing) {
    existing.quantity += quantity;
    existing.store = store || existing.store;
    existing.status = "need";
  } else {
    items.push({
      id: crypto.randomUUID(),
      name,
      quantity,
      store,
      status: "need"
    });
  }

  save();
  render();

  document.getElementById("name").value = "";
  document.getElementById("quantity").value = "";
  document.getElementById("store").value = "";
}

function deleteItem(id) {
  if (!confirm("Remove this item?")) return;
  items = items.filter(i => i.id !== id);
  save();
  render();
}

function toggleStatus(id) {
  const item = items.find(i => i.id === id);
  if (!item) return;

  if (item.status === "need") {
    const qty = prompt("How many did you buy?", item.lastQty || item.quantity || 1);
    item.quantity = Math.max(1, Number(qty) || 1);
    item.lastQty = item.quantity;
    item.status = "have";
  } else {
    item.status = "need";
  }

  save();
  render();
}

function changeQty(id, delta) {
  const item = items.find(i => i.id === id);
  if (!item) return;

  item.quantity += delta;

  if (item.quantity <= (item.minQty ?? 1)) item.status = "need";
  if (item.quantity < 0) item.quantity = 0;

  save();
  render();
}

function smartRestock(id) {
  const item = items.find(i => i.id === id);
  if (!item) return;

  item.quantity = item.lastQty || 1;
  item.status = "have";
  save();
  render();
}

/* =========================
   BATCH ACTIONS
========================= */
function markAllBought() {
  if (!confirm("Mark all visible items as bought?")) return;

  items.forEach(item => {
    if (
      filterStatus === "need" &&
      item.status === "need" &&
      (filterStore === "all" || item.store === filterStore)
    ) {
      item.status = "have";
      item.quantity = Math.max(1, item.quantity);
    }
  });

  save();
  render();
}

function clearHaveItems() {
  if (!confirm("Remove all HAVE items?")) return;

  items = items.filter(item => item.status !== "have");
  save();
  render();
}

/* =========================
   RENDER
========================= */

function renderHistory() {
  const el = document.getElementById("history");
  if (!el) return;

  if (!history.length) {
    el.innerHTML = "<p style='color:#666'>No purchases yet.</p>";
    return;
  }

  el.innerHTML = history
    .map(entry => `
      <div style="margin:12px 0;padding:10px;background:#fff;border-radius:12px;">
        <div style="font-weight:600;">
          ${new Date(entry.date).toLocaleString()}
          ${entry.store ? ` ‚Ä¢ ${entry.store}` : ""}
        </div>
        <div style="font-size:0.9rem;color:#555;margin-top:4px;">
          ${entry.items.map(i => `${i.name} (${i.qty})`).join(", ")}
        </div>
      </div>
    `)
    .join("");
}

renderHistory();

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  updateStoreFilter();

  items
    .filter(item => {
      if (filterStatus !== "all" && item.status !== filterStatus) return false;
      if (filterStore !== "all" && item.store !== filterStore) return false;
      return true;
    })
    .sort((a, b) => a.status.localeCompare(b.status))
    .forEach(item => {
      const div = document.createElement("div");
      div.className = `item ${item.status}`;

      if (shoppingSession?.items.includes(item.id)) {
        div.style.boxShadow = "0 0 0 2px #007aff inset";
      }

      div.innerHTML = `
        <div class="details">
          <div class="name">${item.name}</div>
          <div class="meta">
            Qty: ${item.quantity}
            ${item.store ? ` ‚Ä¢ ${item.store}` : ""}
          </div>
        </div>

        <div class="controls">
          <button class="small-btn" onclick="changeQty('${item.id}', 1)">Ôºã</button>
          <button class="small-btn" onclick="changeQty('${item.id}', -1)">Ôºç</button>

          <button class="small-btn" onclick="toggleStatus('${item.id}')">
            ${item.status === "need" ? "Bought" : "Need"}
          </button>

          ${
            item.status === "need" && item.lastQty
              ? `<button class="small-btn" onclick="smartRestock('${item.id}')">‚Ü∫ Restock</button>`
              : ""
          }

          ${
            shoppingSession && item.status === "need"
              ? `<button class="small-btn" onclick="toggleSessionItem('${item.id}')">
                  ${shoppingSession.items.includes(item.id) ? "‚àí Remove" : "+ Add"}
                </button>`
              : ""
          }

          <button class="small-btn" onclick="deleteItem('${item.id}')">üóë</button>
        </div>
      `;

      list.appendChild(div);
    });
}

/* =========================
   INIT
========================= */
render();
</script>

</body>
</html>