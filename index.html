<!‚Äî Grocery App Code ‚Äî>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Grocery List</title>

<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f5f5f7;
    color: #111;
  }

  .app {
    max-width: 480px;
    margin: 0 auto;
    padding: 16px;
  }

  h1 {
    text-align: center;
    font-size: 1.5rem;
    margin-bottom: 16px;
  }

  .add-form {
    display: grid;
    gap: 8px;
    margin-bottom: 16px;
  }

  input, select, button {
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  button {
    background: #007aff;
    color: white;
    border: none;
    cursor: pointer;
  }

  button:active {
    transform: scale(0.98);
  }

  .list {
    display: grid;
    gap: 10px;
  }

  .item {
    background: white;
    border-radius: 14px;
    padding: 12px;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    align-items: center;
  }

  .item.need {
    border-left: 5px solid #ff3b30;
  }

  .item.have {
    border-left: 5px solid #34c759;
    opacity: 0.85;
  }

  .details {
    display: grid;
    gap: 4px;
  }

  .name {
    font-weight: 600;
  }

  .meta {
    font-size: 0.85rem;
    color: #666;
  }

  .controls {
    display: grid;
    gap: 6px;
  }

  .small-btn {
    padding: 6px 10px;
    font-size: 0.85rem;
    border-radius: 8px;
  }
</style>
</head>
<body>

<div class="app">
  <h1>Grocery List</h1>

  <div class="add-form">
    <input id="name" placeholder="Item name" />
    <input id="quantity" type="number" min="1" placeholder="Quantity" />
    <input id="store" placeholder="Store (optional)" />
    <button onclick="addItem()">Add Item</button>
  </div>

<div class="filters">
  <button onclick="setMode('all')">All</button>
  <button onclick="setMode('shopping')">üõí Shopping</button>
  <button onclick="setMode('inventory')">üì¶ Inventory</button>

<div class="filters">
  <button onclick="markAllBought()">‚úî Buy All</button>
  <button onclick="clearHaveItems()">üßπ Clear Have</button>
</div>

  <select id="storeFilter" onchange="filterStore = this.value; render()">
    <option value="all">All Stores</option>
  </select>
</div>

<div class="filters">
  <button onclick="startSession()">‚ñ∂Ô∏è Start Session</button>
  <button onclick="endSession(true)">‚úî Finish & Apply</button>
  <button onclick="endSession(false)">‚úñ Cancel</button>
</div>

  <div class="list" id="list"></div>
</div>

<script>
  const STORAGE_KEY = "grocery-items";
  let items = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

const UI_STATE_KEY = "grocery-ui-state";

let shoppingSession = null;
// { store: "Target", items: [itemId, itemId, ...] }

const SESSION_KEY = "grocery-shopping-session";
shoppingSession = JSON.parse(localStorage.getItem(SESSION_KEY)) || null;

function saveSession() {
  localStorage.setItem(SESSION_KEY, JSON.stringify(shoppingSession));
}

function startSession() {
  const store = prompt("Shopping where?", filterStore !== "all" ? filterStore : "");
  shoppingSession = { store: store || "", items: [] };
  saveSession();
  render();
}

function endSession(commit = true) {
  if (commit && shoppingSession) {
    shoppingSession.items.forEach(id => {
      const item = items.find(i => i.id === id);
      if (!item) return;

      item.status = "have";
      item.quantity = Math.max(item.lastQty || item.quantity || 1, 1);
      item.lastQty = item.quantity;
    });
    save();
  }

  shoppingSession = null;
  localStorage.removeItem(SESSION_KEY);
  render();
}

function toggleSessionItem(id) {
  if (!shoppingSession) return;

  const idx = shoppingSession.items.indexOf(id);
  if (idx === -1) shoppingSession.items.push(id);
  else shoppingSession.items.splice(idx, 1);

  saveSession();
  render();
}

function updateStoreFilter() {
  const select = document.getElementById("storeFilter");
  if (!select) return;

  const stores = [...new Set(items.map(i => i.store).filter(Boolean))];

const savedUI = JSON.parse(localStorage.getItem(UI_STATE_KEY));
if (savedUI) {
  mode = savedUI.mode || "all";
  filterStatus = savedUI.filterStatus || "all";
  filterStore = savedUI.filterStore || "all";
}

  select.innerHTML = `<option value="all">All Stores</option>` +
    stores.map(s => `<option value="${s}">${s}</option>`).join("");
}

let filterStatus = "all";   // all | need | have
let filterStore = "all";
let mode = "all";          // all | shopping | inventory

function setMode(newMode) {
  mode = newMode;

  if (mode === "shopping") {
    filterStatus = "need";
  } else if (mode === "inventory") {
    filterStatus = "have";
  } else {
    filterStatus = "all";
  }

  render();
}

  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
  }

function saveUIState() {
  localStorage.setItem(
    UI_STATE_KEY,
    JSON.stringify({ mode, filterStatus, filterStore })
  );
}

  function addItem() {
  const name = document.getElementById("name").value.trim();
  const quantity = Number(document.getElementById("quantity").value) || 1;
  const store = document.getElementById("store").value.trim();

  if (!name) return;

  const existing = items.find(
    i => i.name.toLowerCase() === name.toLowerCase()
  );

  if (existing) {
    existing.quantity += quantity;
    existing.store = store || existing.store;
    existing.status = "need";
  } else {
    items.push({
      id: crypto.randomUUID(),
      name,
      quantity,
      store,
      status: "need"
    });
  }

  save();
  render();

  document.getElementById("name").value = "";
  document.getElementById("quantity").value = "";
  document.getElementById("store").value = "";
}


function deleteItem(id) {
  if (!confirm("Remove this item?")) return;
  items = items.filter(i => i.id !== id);
  save();
  render();
}

  function toggleStatus(id) {
  const item = items.find(i => i.id === id);

  if (item.status === "need") {
    const qty = prompt(
      "How many did you buy?",
      item.lastQty || item.quantity || 1
    );

    item.quantity = Math.max(1, Number(qty) || 1);
    item.lastQty = item.quantity;
    item.status = "have";
  } else {
    item.status = "need";
  }

  save();
  render();
}

  function changeQty(id, delta) {
  const item = items.find(i => i.id === id);
  item.quantity += delta;

  if (item.quantity <= (item.minQty ?? 1)) {
    item.status = "need";
  }

  if (item.quantity < 0) item.quantity = 0;

  save();
  render();
}
  save();
  render();
}

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  updateStoreFilter();

  items
    .filter(item => {
      if (filterStatus !== "all" && item.status !== filterStatus) return false;
      if (filterStore !== "all" && item.store !== filterStore) return false;
      return true;
    })
    .sort((a, b) => a.status.localeCompare(b.status))
    .forEach(item => {
      const div = document.createElement("div");
      div.className = `item ${item.status}`;

if (shoppingSession?.items.includes(item.id)) {
  div.style.boxShadow = "0 0 0 2px #007aff inset";
}

      div.innerHTML = `
        <div class="details">
          <div class="name">${item.name}</div>
          <div class="meta">
            Qty: ${item.quantity}
            ${item.store ? ` ‚Ä¢ ${item.store}` : ""}
          </div>
        </div>
        <div class="controls">
          <button class="small-btn" onclick="changeQty('${item.id}', 1)">Ôºã</button>
          <button class="small-btn" onclick="changeQty('${item.id}', -1)">Ôºç</button>
          <button class="small-btn" onclick="toggleStatus('${item.id}')">
            ${item.status === "need" ? "Bought" : "Need"}

${item.status === "need" && item.lastQty
  ? `<button class="small-btn" onclick="smartRestock('${item.id}')">‚Ü∫ Restock</button>`
  : ""
}

${shoppingSession && item.status === "need"
  ? `<button class="small-btn" onclick="toggleSessionItem('${item.id}')">
      ${shoppingSession.items.includes(item.id) ? "‚àí Remove" : "+ Add"}
    </button>`
  : ""
}

          </button>
          <button class="small-btn" onclick="deleteItem('${item.id}')">üóë</button>
        </div>
      `;

      list.appendChild(div);
    });
}

  render();

function smartRestock(id) {
  const item = items.find(i => i.id === id);
  item.quantity = item.lastQty;
  item.status = "have";
  save();
  render();
}

function markAllBought() {
  if (!confirm("Mark all visible items as bought?")) return;

  items.forEach(item => {
    if (
      filterStatus === "need" &&
      item.status === "need" &&
      (filterStore === "all" || item.store === filterStore)
    ) {
      item.status = "have";
      item.quantity = Math.max(1, item.quantity);
    }
  });

  save();
  render();
}

function clearHaveItems() {
  if (!confirm("Remove all HAVE items?")) return;

  items = items.filter(item => item.status !== "have");
  save();
  render();
}

</script>

</body>
</html>